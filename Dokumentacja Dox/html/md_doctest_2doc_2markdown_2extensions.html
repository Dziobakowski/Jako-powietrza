<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="pl">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Jakość powietrza w Polsce: Extensions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Jakość powietrza w Polsce
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Szukaj" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Wygenerowano za pomocą Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md_doctest_2doc_2markdown_2extensions.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Wczytywanie...</div>
<div class="SRStatus" id="Searching">Szukanie...</div>
<div class="SRStatus" id="NoMatches">Brak dopasowań</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Extensions</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md113"></a></p>
<p>The doctest header doesn't include any external or stdlib headers in its interface part in order to provide the most optimal build times but that means it is limited in what it can provide as functionality =&gt; that's when extensions come into play. They are located as header files in <a href="../../doctest/extensions"><code>doctest/extensions</code></a> and each of them is documented in a section here.</p>
<h1><a class="anchor" id="autotoc_md114"></a>
<a href="../../doctest/extensions/doctest_util.h">Utils</a></h1>
<p>nothing here yet...</p>
<h1><a class="anchor" id="autotoc_md115"></a>
<a href="../../doctest/extensions/doctest_mpi.h">Distributed tests with MPI</a></h1>
<p>[Bruno Maugars and Bérenger Berthoul, ONERA]</p>
<p>Testing code over distributed processes requires support from the testing framework. <b>Doctest</b> support for MPI parallel communication is provided in the <code>"doctest/extensions/doctest_mpi.h"</code> header.</p>
<h2><a class="anchor" id="autotoc_md116"></a>
Example</h2>
<p>See <a href="../../examples/mpi/mpi.cpp"><b>the complete test</b></a> and <a href="../../examples/mpi/main.cpp"><b>the configuration of main()</b></a></p>
<h3><a class="anchor" id="autotoc_md117"></a>
MPI_TEST_CASE</h3>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="doctest__mpi_8h.html">doctest/extensions/doctest_mpi.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> my_function_to_test(MPI_Comm comm) {</div>
<div class="line">  <span class="keywordtype">int</span> rank;</div>
<div class="line">  MPI_Comm_rank(comm,&amp;rank);</div>
<div class="line">  <span class="keywordflow">if</span> (rank == 0) {</div>
<div class="line">    <span class="keywordflow">return</span> 10;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> 11;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><a class="code hl_define" href="doctest__mpi_8h.html#adeb675f0bdbca13fc774b131c5288200">MPI_TEST_CASE</a>(<span class="stringliteral">&quot;test over two processes&quot;</span>,2) { <span class="comment">// Parallel test on 2 processes</span></div>
<div class="line">  <span class="keywordtype">int</span> x = my_function_to_test(test_comm);</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_define" href="doctest__mpi_8h.html#ad4c11f2e4f10a81ac76e5e24d5dad03f">MPI_CHECK</a>( 0,  x==10 ); <span class="comment">// CHECK for rank 0, that x==10</span></div>
<div class="line">  <a class="code hl_define" href="doctest__mpi_8h.html#ad4c11f2e4f10a81ac76e5e24d5dad03f">MPI_CHECK</a>( 1,  x==11 ); <span class="comment">// CHECK for rank 1, that x==11</span></div>
<div class="line">}</div>
<div class="ttc" id="adoctest__mpi_8h_html"><div class="ttname"><a href="doctest__mpi_8h.html">doctest_mpi.h</a></div></div>
<div class="ttc" id="adoctest__mpi_8h_html_ad4c11f2e4f10a81ac76e5e24d5dad03f"><div class="ttname"><a href="doctest__mpi_8h.html#ad4c11f2e4f10a81ac76e5e24d5dad03f">MPI_CHECK</a></div><div class="ttdeci">#define MPI_CHECK</div><div class="ttdef"><b>Definicja</b> doctest_mpi.h:157</div></div>
<div class="ttc" id="adoctest__mpi_8h_html_adeb675f0bdbca13fc774b131c5288200"><div class="ttname"><a href="doctest__mpi_8h.html#adeb675f0bdbca13fc774b131c5288200">MPI_TEST_CASE</a></div><div class="ttdeci">#define MPI_TEST_CASE</div><div class="ttdef"><b>Definicja</b> doctest_mpi.h:163</div></div>
</div><!-- fragment --><p>An <code>MPI_TEST_CASE</code> is like a regular <code>TEST_CASE</code>, except it takes a second argument, which is the number of processes needed to run the test. If the number of processes is less than 2, the test will fail. If the number of processes is greater than or equal to 2, it will create a sub-communicator over 2 processes, called <code>test_comm</code>, and execute the test over these processes. Three objects are provided by <code>MPI_TEST_CASE</code>:</p><ul>
<li><code>test_comm</code>, of type <code>MPI_Comm</code>: the mpi communicator on which the test is running,</li>
<li><code>test_rank</code> and <code>test_nb_procs</code>, two <code>int</code> giving respectively the rank of the current process and the size of the communicator for <code>test_comm</code>. These last two are just here for convenience and could be retrieved from <code>test_comm</code>.</li>
</ul>
<p>We always have:</p>
<div class="fragment"><div class="line"><a class="code hl_define" href="doctest__mpi_8h.html#adeb675f0bdbca13fc774b131c5288200">MPI_TEST_CASE</a>(<span class="stringliteral">&quot;my_test&quot;</span>,<a class="code hl_namespace" href="namespace_n.html">N</a>) {</div>
<div class="line">  <a class="code hl_define" href="doctest_2doctest_8h.html#a836cca6b6ed3a1706353f6d1bca0935f">CHECK</a>( test_nb_procs == <a class="code hl_namespace" href="namespace_n.html">N</a> );</div>
<div class="line">  <a class="code hl_define" href="doctest__mpi_8h.html#ad4c11f2e4f10a81ac76e5e24d5dad03f">MPI_CHECK</a>( i, test_rank==i ); <span class="comment">// for any i&lt;N</span></div>
<div class="line">}</div>
<div class="ttc" id="adoctest_2doctest_8h_html_a836cca6b6ed3a1706353f6d1bca0935f"><div class="ttname"><a href="doctest_2doctest_8h.html#a836cca6b6ed3a1706353f6d1bca0935f">CHECK</a></div><div class="ttdeci">#define CHECK(...)</div><div class="ttdef"><b>Definicja</b> doctest.h:2969</div></div>
<div class="ttc" id="anamespace_n_html"><div class="ttname"><a href="namespace_n.html">N</a></div><div class="ttdef"><b>Definicja</b> stringification.cpp:16</div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md118"></a>
Assertions</h3>
<p>It is possible to use regular assertions in an <code>MPI_TEST_CASE</code>. MPI-specific assertions are also provided and are all prefixed with <code>MPI_</code> (<code>MPI_CHECK</code>, <code>MPI_ASSERT</code>...). The first argument is the rank for which they are checked, and the second is the usual expression to check.</p>
<h2><a class="anchor" id="autotoc_md119"></a>
The main entry points and mpi reporters</h2>
<p>You need to launch the unit tests with an <code>mpirun</code> or <code>mpiexec</code> command: </p><div class="fragment"><div class="line">mpirun -np 2 unit_test_executable.exe</div>
</div><!-- fragment --><div class="fragment"><div class="line">::mpi_init_thread()</div>
</div><!-- fragment --><p> must be called before running the unit tests, and <code><a class="el" href="namespacedoctest.html#abe48bb917f3ad5bb3a129d6b11058bed">doctest::mpi_finalize()</a></code> at the end of the program. Also, using the default console reporter will result in each process writing everything in the same place, which is not what we want. Two reporters are provided and can be enabled. A complete <code><a class="el" href="how__exception__translators__work_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main()</a></code> would be:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define DOCTEST_CONFIG_IMPLEMENT</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="doctest__mpi_8h.html">doctest/extensions/doctest_mpi.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="how__exception__translators__work_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv) {</div>
<div class="line">  <a class="code hl_function" href="namespacedoctest.html#a3cadc91a1955b20cb6b529b0dd0fc069">doctest::mpi_init_thread</a>(argc,argv,MPI_THREAD_MULTIPLE); <span class="comment">// Or any MPI thread level</span></div>
<div class="line"> </div>
<div class="line">  <a class="code hl_class" href="classdoctest_1_1_context.html">doctest::Context</a> ctx;</div>
<div class="line">  ctx.<a class="code hl_function" href="classdoctest_1_1_context.html#a7f7735caa75c60cdf8c8d86a75ce1d81">setOption</a>(<span class="stringliteral">&quot;reporters&quot;</span>, <span class="stringliteral">&quot;MpiConsoleReporter&quot;</span>);</div>
<div class="line">  ctx.<a class="code hl_function" href="classdoctest_1_1_context.html#a7f7735caa75c60cdf8c8d86a75ce1d81">setOption</a>(<span class="stringliteral">&quot;reporters&quot;</span>, <span class="stringliteral">&quot;MpiFileReporter&quot;</span>);</div>
<div class="line">  ctx.<a class="code hl_function" href="classdoctest_1_1_context.html#a7f7735caa75c60cdf8c8d86a75ce1d81">setOption</a>(<span class="stringliteral">&quot;force-colors&quot;</span>, <span class="keyword">true</span>);</div>
<div class="line">  ctx.<a class="code hl_function" href="classdoctest_1_1_context.html#ad55229220bf9ca74e6e0c6323bf672e1">applyCommandLine</a>(argc, argv);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">int</span> test_result = ctx.<a class="code hl_function" href="classdoctest_1_1_context.html#a8059b137ef41cbe6c5d8160806a3cc63">run</a>();</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_function" href="namespacedoctest.html#abe48bb917f3ad5bb3a129d6b11058bed">doctest::mpi_finalize</a>();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> test_result;</div>
<div class="line">}</div>
<div class="ttc" id="aclassdoctest_1_1_context_html"><div class="ttname"><a href="classdoctest_1_1_context.html">doctest::Context</a></div><div class="ttdef"><b>Definicja</b> doctest.h:1965</div></div>
<div class="ttc" id="aclassdoctest_1_1_context_html_a7f7735caa75c60cdf8c8d86a75ce1d81"><div class="ttname"><a href="classdoctest_1_1_context.html#a7f7735caa75c60cdf8c8d86a75ce1d81">doctest::Context::setOption</a></div><div class="ttdeci">void setOption(const char *option, bool value)</div><div class="ttdef"><b>Definicja</b> doctest.cpp:3655</div></div>
<div class="ttc" id="aclassdoctest_1_1_context_html_a8059b137ef41cbe6c5d8160806a3cc63"><div class="ttname"><a href="classdoctest_1_1_context.html#a8059b137ef41cbe6c5d8160806a3cc63">doctest::Context::run</a></div><div class="ttdeci">int run()</div><div class="ttdef"><b>Definicja</b> doctest.cpp:3704</div></div>
<div class="ttc" id="aclassdoctest_1_1_context_html_ad55229220bf9ca74e6e0c6323bf672e1"><div class="ttname"><a href="classdoctest_1_1_context.html#ad55229220bf9ca74e6e0c6323bf672e1">doctest::Context::applyCommandLine</a></div><div class="ttdeci">void applyCommandLine(int argc, const char *const *argv)</div><div class="ttdef"><b>Definicja</b> doctest.cpp:3513</div></div>
<div class="ttc" id="ahow__exception__translators__work_8cpp_html_ae66f6b31b5ad750f1fe042a706a4e3d4"><div class="ttname"><a href="how__exception__translators__work_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a></div><div class="ttdeci">int main()</div><div class="ttdef"><b>Definicja</b> how_exception_translators_work.cpp:82</div></div>
<div class="ttc" id="anamespacedoctest_html_a3cadc91a1955b20cb6b529b0dd0fc069"><div class="ttname"><a href="namespacedoctest.html#a3cadc91a1955b20cb6b529b0dd0fc069">doctest::mpi_init_thread</a></div><div class="ttdeci">int mpi_init_thread(int argc, char *argv[], int required_thread_support)</div></div>
<div class="ttc" id="anamespacedoctest_html_abe48bb917f3ad5bb3a129d6b11058bed"><div class="ttname"><a href="namespacedoctest.html#abe48bb917f3ad5bb3a129d6b11058bed">doctest::mpi_finalize</a></div><div class="ttdeci">void mpi_finalize()</div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md120"></a>
MpiConsoleReporter</h3>
<p>The <code>MpiConsoleReporter</code> should be substituted to the default reporter. It does the same as the default console reporter for regular assertions, but only outputs on process 0. For MPI test cases, if there is a failure it tells the process that failed</p>
<div class="fragment"><div class="line">[doctest] doctest version is &quot;2.4.0&quot;</div>
<div class="line">[doctest] run with &quot;--help&quot; for options</div>
<div class="line">===============================================================================</div>
<div class="line">[doctest] test cases:    171 |    171 passed |      0 failed |      0 skipped</div>
<div class="line">[doctest] assertions:    864 |    864 passed |      0 failed |</div>
<div class="line">[doctest] Status: SUCCESS!</div>
<div class="line">std_e_mpi_unit_tests</div>
<div class="line">[doctest] doctest version is &quot;2.4.0&quot;</div>
<div class="line">[doctest] run with &quot;--help&quot; for options</div>
<div class="line">===============================================================================</div>
<div class="line">path/to/test.cpp:30:</div>
<div class="line">TEST CASE: my test case</div>
<div class="line"> </div>
<div class="line">On rank [2] : path/to/test.cpp:35: CHECK( x==-1 ) is NOT correct!</div>
<div class="line">  values: CHECK( 0 == -1 )</div>
<div class="line"> </div>
<div class="line">===============================================================================</div>
<div class="line">[doctest] test cases:      2 |      2 passed |      0 failed |      0 skipped</div>
<div class="line">[doctest] assertions:      2 |      2 passed |      0 failed |</div>
<div class="line">[doctest] Status: SUCCESS!</div>
<div class="line">===============================================================================</div>
<div class="line">[doctest] assertions on all processes:   5 |   4 passed |      1 failed |</div>
<div class="line">===============================================================================</div>
<div class="line">[doctest] fail on rank:</div>
<div class="line">    -&gt; On rank [2] with 1 test failed</div>
<div class="line">[doctest] Status: FAILURE!</div>
</div><!-- fragment --><p>If the test executable is launch with less processes than the number of processes required by one test, the test is skipped and marqued as such in the mpi console reporter:</p>
<div class="fragment"><div class="line"><a class="code hl_define" href="doctest__mpi_8h.html#adeb675f0bdbca13fc774b131c5288200">MPI_TEST_CASE</a>(<span class="stringliteral">&quot;my_test&quot;</span>,3) {</div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line">}</div>
</div><!-- fragment --><div class="fragment"><div class="line">mpirun -np 2 unit_test_executable.exe</div>
</div><!-- fragment --><div class="fragment"><div class="line">===============================================================================</div>
<div class="line">[doctest] test cases:      1 |      1 passed |      0 failed |      1 skipped</div>
<div class="line">[doctest] assertions:      1 |      1 passed |      0 failed |</div>
<div class="line">[doctest] Status: SUCCESS!</div>
<div class="line">===============================================================================</div>
<div class="line">[doctest] assertions on all processes:   1 |   1 passed |      0 failed |</div>
<div class="line">[doctest] WARNING: Skipped 1 test requiring more than 2 MPI processes to run</div>
<div class="line">===============================================================================</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md121"></a>
MpiFileReporter</h3>
<p>The <code>MpiFileReporter</code> will just print the result of each process in its own file, named <code>doctest_[rank].log</code>. Only use this reporter as a debug facility if you want to know what is going on exactly when a parallel test case is failing.</p>
<h3><a class="anchor" id="autotoc_md122"></a>
Other reporters</h3>
<p>Other reporters (jUnit, XML) are not supported directly, which mean that you can always print the result of each process to its own file, but there is (currently) no equivalent of the <code>MpiConsoleReporter</code> that will aggregate the results of all processes.</p>
<h2><a class="anchor" id="autotoc_md123"></a>
Note</h2>
<p>This feature is provided to unit-test mpi-distributed code. It is <b>not</b> a way to parallelize many unit tests over several processes (for that, see <a href="../../examples/range_based_execution.py"><b>the example python script</b></a>).</p>
<h2><a class="anchor" id="autotoc_md124"></a>
TODO</h2>
<ul>
<li>Pass <code>s</code> member variable of <code>ConsoleReporter</code> as an argument to member functions so we can use them with another object (would help to factorize <code>MPIConsoleReporter</code>)</li>
<li>Only MPI_CHECK tested. MPI_REQUIRE, exception handling: nothing tested</li>
<li>More testing, automatic testing</li>
<li>Packaging: create a new target <code>mpi_doctest</code>? (probably cleaner to depend explicitly on MPI for mpi/doctest.h)</li>
<li>Later, maybe: have a general mechanism to represent assertions so we can separate the report format (console, xml, junit...) from the reporting strategy (sequential vs. MPI)</li>
</ul>
<hr  />
<p><a href="readme.md#reference">Home</a></p>
<p><img src="../../scripts/data/logo/icon_2.svg" alt="" style="pointer-events: none;" class="inline"/></p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Wygenerowano za pomocą <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
